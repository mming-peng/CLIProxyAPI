# CLIProxyAPI 项目概览

## 项目简介

**CLIProxyAPI** 是一个为 CLI 工具提供 OpenAI/Gemini/Claude/Codex 兼容 API 接口的代理服务器。它允许用户使用本地或多账户的 CLI 方式，通过任何与 OpenAI/Gemini/Claude 兼容的客户端和 SDK 进行访问。

### 核心价值

- **统一接口**：为多个 AI 服务提供商提供统一的 API 接口
- **多账户支持**：支持多账户轮询和负载均衡
- **OAuth 认证**：支持通过 OAuth 登录接入各种 AI 服务
- **协议转换**：自动在不同 AI 服务的请求/响应格式之间进行转换
- **可扩展性**：提供可复用的 Go SDK，便于集成到其他项目

## 技术栈

### 核心框架
- **Go 版本**：1.24.0
- **Web 框架**：Gin (v1.10.1)
- **HTTP 客户端**：标准库 `net/http` + 自定义增强

### 主要依赖

| 依赖包 | 版本 | 用途 |
|--------|------|------|
| `gin-gonic/gin` | v1.10.1 | HTTP Web 框架 |
| `gorilla/websocket` | v1.5.3 | WebSocket 支持 |
| `google/uuid` | v1.6.0 | UUID 生成 |
| `sirupsen/logrus` | v1.9.3 | 日志系统 |
| `fsnotify/fsnotify` | v1.9.0 | 文件监控 |
| `tidwall/gjson` | v1.18.0 | JSON 解析和查询 |
| `tidwall/sjson` | v1.2.5 | JSON 修改 |
| `tiktoken-go/tokenizer` | v0.7.0 | Token 计数 |
| `golang.org/x/oauth2` | v0.30.0 | OAuth2 认证 |
| `jackc/pgx/v5` | v5.7.6 | PostgreSQL 客户端 |

## 支持的 AI 服务提供商

### 基于 OAuth 的提供商
1. **OpenAI Codex** (GPT 系列)
2. **Claude Code** (Anthropic)
3. **Qwen Code** (阿里通义千问)
4. **iFlow**
5. **Antigravity**

### 基于 API Key 的提供商
1. **Gemini** (Google AI Studio API Key)
2. **Claude API** (官方 API Key)
3. **Codex API** (官方 API Key)
4. **OpenAI 兼容提供商** (例如 OpenRouter)

## 核心功能特性

### 1. 多协议支持
- ✅ OpenAI Chat Completions API
- ✅ OpenAI Responses API
- ✅ Claude Messages API
- ✅ Gemini GenerateContent API
- ✅ 流式与非流式响应
- ✅ 函数调用/工具支持
- ✅ 多模态输入（文本、图片）

### 2. 认证与授权
- ✅ OAuth 2.0 认证流程
- ✅ API Key 认证
- ✅ 多账户管理
- ✅ Token 自动刷新
- ✅ 凭据安全存储

### 3. 负载均衡与容错
- ✅ 多账户轮询
- ✅ 请求重试机制（针对 403, 408, 500, 502, 503, 504 错误）
- ✅ 配额超限自动切换
- ✅ 预览模型回退

### 4. 管理功能
- ✅ 远程管理 API
- ✅ 管理控制面板
- ✅ 使用统计
- ✅ WebSocket API 支持

### 5. 可扩展性
- ✅ 可复用的 Go SDK
- ✅ 自定义 Provider 支持
- ✅ 翻译器插件系统
- ✅ 中间件扩展

## 项目结构

```
CLIProxyAPI/
├── cmd/                    # 命令行入口
│   └── server/            # 服务器主程序
│       └── main.go        # 程序入口点
├── internal/              # 内部实现（不对外导出）
│   ├── access/           # 请求访问控制
│   ├── api/              # HTTP API 服务器
│   ├── auth/             # 认证模型
│   ├── browser/          # 浏览器集成
│   ├── config/           # 配置加载
│   ├── interfaces/       # 接口定义
│   ├── logging/          # 日志系统
│   ├── registry/         # 模型注册表
│   ├── store/            # 存储层
│   ├── translator/       # 协议转换器
│   ├── usage/            # 使用统计
│   ├── watcher/          # 文件监控
│   └── wsrelay/          # WebSocket 中继
├── sdk/                   # 可导出的 SDK
│   ├── access/           # 访问管理 SDK
│   ├── api/              # API 处理器 SDK
│   │   └── handlers/     # 各协议处理器
│   ├── auth/             # 认证管理 SDK
│   ├── cliproxy/         # 核心服务 SDK
│   │   └── auth/         # 运行时认证
│   ├── config/           # 配置 SDK
│   └── translator/       # 翻译器 SDK
├── docs/                  # 文档
├── examples/              # 示例代码
│   ├── custom-provider/  # 自定义提供商示例
│   └── translator/       # 翻译器示例
├── auths/                 # 认证文件存储目录
├── config.example.yaml    # 配置文件示例
├── docker-compose.yml     # Docker Compose 配置
├── Dockerfile            # Docker 镜像定义
└── go.mod                # Go 模块定义
```

## 部署方式

### 1. 直接运行
```bash
go run cmd/server/main.go -config config.yaml
```

### 2. Docker 部署
```bash
docker-compose up -d
```

### 3. 构建二进制
```bash
go build -o cliproxy-api cmd/server/main.go
./cliproxy-api -config config.yaml
```

## 应用场景

### 1. AI 编程工具集成
- Cursor
- Visual Studio Code
- Cline
- Roo Code
- Amp CLI/IDE

### 2. 多账户管理
- 企业级 AI 服务管理
- 配额均衡分配
- 使用统计和监控

### 3. 协议转换
- 将 OpenAI 格式的请求转换为 Claude/Gemini 格式
- 统一多个 AI 服务的访问接口

### 4. 本地开发调试
- 本地代理 AI 服务
- 请求/响应日志记录
- API 调试和测试

## 相关项目

### 基于 CLIProxyAPI 构建的项目

#### [vibeproxy](https://github.com/automazeio/vibeproxy)
一个原生 macOS 菜单栏应用，让用户可以使用 Claude Code & ChatGPT 订阅服务和 AI 编程工具，无需 API 密钥。

#### [Subtitle Translator](https://github.com/VjayC/SRT-Subtitle-Translator-Validator)
一款基于浏览器的 SRT 字幕翻译工具，可通过 CLI 代理 API 使用您的 Gemini 订阅。内置自动验证与错误修正功能，无需 API 密钥。

## 许可证

此项目根据 **MIT 许可证**授权。

## 社区支持

- **QQ 群**：188637136
- **Telegram 群**：https://t.me/CLIProxyAPI

## 赞助商

本项目由智谱提供赞助，智谱通过 GLM CODING PLAN 为本项目提供技术支持。
